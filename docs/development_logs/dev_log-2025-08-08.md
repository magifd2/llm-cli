# Development Log

This document records the detailed development history and key decisions made during the project.

## 2025-08-08 (Feature: Enhanced Vertex AI System Prompt Handling)

- **Objective**: To improve the handling of system prompts for the Google Cloud Vertex AI provider by implementing a more robust workaround for the SDK's lack of native system prompt support.
- **Problem**: The existing `vertexai` provider simulated system prompts by sending them as the first user message. While functional, this approach could sometimes lead to inconsistent model behavior.
- **Solution**: 
    1.  **New Provider (`vertexai2`)**: Introduced a new provider named `vertexai2` to house the enhanced implementation without affecting the existing, stable `vertexai` provider.
    2.  **History Priming**: The `vertexai2` provider now primes the conversation by injecting a two-turn history at the beginning of the chat session. It passes a `history` slice to `client.Chats.Create()` containing:
        - A `user` role message with the content of the system prompt.
        - A `model` role message with a simple acknowledgment (e.g., "OK.").
    3.  **SDK Analysis**: The development process involved significant trial and error due to misunderstandings of the `google.golang.org/genai` SDK. The final, correct implementation was achieved after analyzing the SDK's source code (`chats.go`, `types.go`) to correctly construct the `history` slice with `[]*genai.Content` and `[]*genai.Part` types.
- **Implementation Details**:
    - `internal/llm/vertexai2.go`: Created a new file for the `VertexAI2Provider`.
    - `cmd/prompt.go`: Added a `case` for `vertexai2` to the provider selection `switch`.
    - `internal/config/config.go`: Updated comments to include `vertexai2` as a valid provider option.
    - `README.md` & `README.ja.md`: Updated to explain the two Vertex AI providers and the benefits of the new `vertexai2` history priming method.
    - `CHANGELOG.md` & `CHANGELOG.ja.md`: Added an entry for the new feature.
- **Outcome**: The new `vertexai2` provider offers a more reliable method for setting the context for conversations with Vertex AI models, leading to more predictable and consistent outputs.